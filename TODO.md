# CLAM Shell - 未実装機能一覧

このドキュメントは、bash.ebnfに基づいた未実装機能と既知の制限事項をリストアップしています。

## 実装状況サマリー

- ✅ **実装済み**: 基本的なコマンド実行、制御構造、変数展開
- ⚠️ **部分実装**: リダイレクション、パイプライン、for/case構文
- ❌ **未実装**: select、time、高度な機能

---

## 1. 基本機能

### ✅ 実装済み
- [x] Simple command実行 (`ls -la`)
- [x] 変数代入 (`A=value`)
- [x] 変数展開 (`$VAR`, `${VAR}`)
- [x] 引用符処理 (`'...'`, `"..."`)
- [x] 単語分割 (word splitting)
- [x] コメント (`#`)

### ⚠️ 部分実装
- [ ] エスケープシーケンス (`\n`, `\t`など) - ダブルクォート内のみ部分対応
- [ ] バッククォート (\`command\`)
- [ ] コマンド置換 (`$(command)`)
- [ ] 算術展開 (`$((expr))`)
- [ ] ブレース展開 (`{a,b,c}`, `{1..10}`)
- [ ] チルダ展開 (`~`, `~/path`)
- [ ] グロブ展開 (`*.txt`, `?.md`)

---

## 2. リダイレクション

### ✅ 実装済み (パース済み、実行は未実装)
- [x] 出力リダイレクション (`>`, `>>`)
- [x] 入力リダイレクション (`<`)
- [x] Here document (`<<`)
- [x] Here string (`<<<`)
- [x] ファイル記述子の複製 (`>&`, `<&`)
- [x] クローバー (`>|`)
- [x] 入出力 (`<>`)
- [x] 標準エラー出力 (`&>`, `2>`)

### ❌ 実行が未実装
- [ ] リダイレクションの実際の実行 (ファイルへの書き込み/読み込み)
- [ ] Here documentの実行
- [ ] ファイル記述子操作の実行

---

## 3. パイプライン

### ⚠️ 部分実装
- [x] パイプラインのパース (`cmd1 | cmd2`)
- [x] 否定付きパイプライン (`! cmd`)
- [ ] パイプラインの実行 (プロセス間通信)
- [ ] パイプラインのexit status処理

---

## 4. リスト・論理演算子

### ✅ 実装済み
- [x] セミコロン (`;`) - 順次実行
- [x] AND演算子 (`&&`)
- [x] OR演算子 (`||`)

### ⚠️ 部分実装
- [x] バックグラウンド実行 (`&`) - パース済み、実行未実装

---

## 5. 制御構造

### ✅ if文
- [x] `if...then...fi`
- [x] `if...then...else...fi`
- [x] `elif`句
- [x] 複数コマンドのサポート

### ✅ ループ
- [x] `while...do...done`
- [x] `until...do...done`
- [x] `for var in words; do...done`

### ⚠️ for文の拡張パターン (未実装)
- [ ] `for var do...done` (引数リストループ)
- [ ] `for var; do...done`
- [ ] `for var in words; do...done` (改行区切り)
- [ ] `for var in words; { ... }` (ブレース構文)
- [ ] C言語スタイル: `for ((i=0; i<10; i++))`

### ⚠️ case文
- [x] 基本的なcase文 (`case...in...esac`)
- [x] パターンマッチング
- [x] `;;` 区切り
- [ ] `;;&` (fall-through)
- [ ] `;&` (次のケースも実行)
- [ ] グロブパターンのサポート

### ❌ select文 (完全未実装)
- [ ] `select var in words; do...done`
- [ ] `select var; do...done`
- [ ] ブレース構文

---

## 6. 関数

### ⚠️ 部分実装
- [x] `function name { ... }` 形式
- [ ] `name() { ... }` 形式 (function キーワードなし)
- [ ] `function name() { ... }` 形式
- [ ] 関数の実行
- [ ] ローカル変数 (`local`)
- [ ] 戻り値 (`return`)
- [ ] 位置パラメータ (`$1`, `$2`, ...)

---

## 7. サブシェルとグループコマンド

### ✅ 実装済み
- [x] サブシェル (`(command)`) - パース済み
- [x] グループコマンド (`{ command; }`) - パース済み

### ❌ 実行が未実装
- [ ] サブシェルの実行
- [ ] グループコマンドの実行

---

## 8. 特殊変数

### ❌ 未実装
- [ ] `$?` - 最後のコマンドのexit status
- [ ] `$$` - 現在のシェルのPID
- [ ] `$!` - 最後のバックグラウンドジョブのPID
- [ ] `$0` - シェル名/スクリプト名
- [ ] `$1, $2, ...` - 位置パラメータ
- [ ] `$#` - 位置パラメータの数
- [ ] `$@` - すべての位置パラメータ (配列)
- [ ] `$*` - すべての位置パラメータ (文字列)
- [ ] `$-` - 現在のオプションフラグ
- [ ] `$_` - 最後のコマンドの最後の引数

---

## 9. 組み込みコマンド

### ❌ 未実装
- [ ] `cd` - ディレクトリ変更
- [ ] `pwd` - カレントディレクトリ表示
- [ ] `echo` - 組み込み版 (現在は外部コマンド)
- [ ] `exit` - シェル終了
- [ ] `export` - 環境変数エクスポート
- [ ] `unset` - 変数削除
- [ ] `read` - 入力読み込み
- [ ] `source` / `.` - スクリプト実行
- [ ] `eval` - 文字列を評価
- [ ] `set` - シェルオプション設定
- [ ] `shift` - 位置パラメータシフト
- [ ] `test` / `[` - 条件テスト
- [ ] `[[` - 拡張条件テスト
- [ ] `let` - 算術評価
- [ ] `declare` / `typeset` - 変数宣言
- [ ] `readonly` - 読み取り専用変数
- [ ] `local` - ローカル変数
- [ ] `return` - 関数からの戻り
- [ ] `break` - ループ脱出
- [ ] `continue` - ループ継続
- [ ] `trap` - シグナルハンドラ
- [ ] `jobs` - ジョブ一覧
- [ ] `fg` - フォアグラウンド化
- [ ] `bg` - バックグラウンド化
- [ ] `kill` - シグナル送信
- [ ] `wait` - ジョブ待機
- [ ] `alias` - エイリアス定義
- [ ] `unalias` - エイリアス削除
- [ ] `history` - コマンド履歴
- [ ] `help` - ヘルプ表示
- [ ] `type` - コマンドタイプ表示
- [ ] `command` - コマンド実行
- [ ] `builtin` - 組み込みコマンド実行
- [ ] `enable` - 組み込みコマンド有効/無効化
- [ ] `printf` - フォーマット出力
- [ ] `getopts` - オプション解析
- [ ] `exec` - コマンド置換
- [ ] `logout` - ログアウト
- [ ] `times` - プロセス時間表示
- [ ] `ulimit` - リソース制限

---

## 10. ジョブ制御

### ❌ 未実装
- [ ] バックグラウンド実行 (`&`)
- [ ] ジョブサスペンド (`Ctrl+Z`)
- [ ] フォアグラウンド復帰 (`fg`)
- [ ] バックグラウンド実行 (`bg`)
- [ ] ジョブ一覧 (`jobs`)
- [ ] ジョブ参照 (`%1`, `%name`)

---

## 11. time コマンド

### ❌ 完全未実装
- [ ] `time command` - コマンド実行時間測定
- [ ] `time -p command` - POSIX形式
- [ ] `time ! command`
- [ ] `! time command`

---

## 12. 配列

### ❌ 未実装
- [ ] 配列定義 (`arr=(a b c)`)
- [ ] 配列要素アクセス (`${arr[0]}`)
- [ ] 配列全体 (`${arr[@]}`, `${arr[*]}`)
- [ ] 配列長 (`${#arr[@]}`)
- [ ] 連想配列 (`declare -A`)

---

## 13. 文字列操作

### ❌ 未実装
- [ ] 文字列長 (`${#var}`)
- [ ] 部分文字列 (`${var:offset:length}`)
- [ ] パターン削除 (`${var#pattern}`, `${var##pattern}`)
- [ ] パターン削除 (`${var%pattern}`, `${var%%pattern}`)
- [ ] パターン置換 (`${var/pattern/replacement}`)
- [ ] 大文字小文字変換 (`${var^^}`, `${var,,}`)
- [ ] デフォルト値 (`${var:-default}`, `${var:=default}`)
- [ ] エラー処理 (`${var:?error}`)
- [ ] 代替値 (`${var:+alternate}`)

---

## 14. 算術演算

### ❌ 未実装
- [ ] 算術展開 (`$((expression))`)
- [ ] 算術評価 (`let`)
- [ ] 算術条件 (`((expression))`)

---

## 15. プロセス置換

### ❌ 未実装
- [ ] `<(command)` - プロセス置換
- [ ] `>(command)` - プロセス置換

---

## 16. 高度な機能

### ❌ 未実装
- [ ] コマンド履歴展開 (`!!`, `!n`, `!string`)
- [ ] ディレクトリスタック (`pushd`, `popd`, `dirs`)
- [ ] 補完機能 (`complete`)
- [ ] プロンプトカスタマイズ (`PS1`, `PS2`)
- [ ] シェルオプション (`shopt`)
- [ ] デバッグモード (`set -x`)
- [ ] エラーで停止 (`set -e`)
- [ ] 未定義変数でエラー (`set -u`)
- [ ] パイプラインのエラー伝播 (`set -o pipefail`)

---

## 17. スクリプト実行

### ❌ 未実装
- [ ] シバン (`#!/bin/bash`) 処理
- [ ] スクリプトファイルの実行
- [ ] コマンドライン引数 (`$1`, `$2`, ...)
- [ ] `-c` オプション (コマンド文字列実行)
- [ ] `-i` オプション (インタラクティブモード)
- [ ] `-x` オプション (デバッグモード)

---

## 18. その他の制限事項

### Lexer/Parser
- [ ] 複雑なエスケープシーケンス
- [ ] 行継続 (`\` at end of line)
- [ ] ANSI-Cクォート (`$'...'`)
- [ ] 変数展開後のパス名展開
- [ ] `${HOME}/test` のような変数展開+文字列連結が不完全

### Executor
- [ ] シグナル処理
- [ ] 環境変数の継承 (部分的に実装済み)
- [ ] Exit statusの正確な処理
- [ ] エラーハンドリング

### パフォーマンス
- [ ] 大きなファイルの処理
- [ ] メモリ効率
- [ ] パイプラインのバッファリング

---

## 優先度別実装計画

### 🔴 高優先度 (基本機能)
1. 組み込みコマンド (`cd`, `pwd`, `exit`, `echo`)
2. パイプラインの実行
3. リダイレクションの実行
4. 特殊変数 (`$?`, `$0`, `$1-$9`)
5. バックグラウンド実行

### 🟡 中優先度 (便利な機能)
6. グロブ展開 (`*.txt`)
7. コマンド置換 (`$(...)`)
8. サブシェル/グループコマンドの実行
9. 関数の実行
10. `test`/`[`コマンド

### 🟢 低優先度 (高度な機能)
11. ジョブ制御
12. 配列
13. 文字列操作
14. 算術演算
15. プロセス置換
16. 履歴展開

---

## 既知のバグ

1. エラーメッセージが不親切
2. パースエラー時のリカバリーが不十分

---

## 参考

- bash.ebnf: `/Users/sh-morishita/Private/clam/docs/bash.ebnf`
- 実装済み機能は `src/executor.rs` を参照
- パーサーの実装状況は `src/parser.rs` を参照
